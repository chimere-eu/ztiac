# OpenBao Deployment Example

## 🔍 Overview 

This example showcases how to deploy [OpenBao](https://github.com/openbao/openbao) on the Outscale  cloud platform using Terraform/Opentofu. It includes all necessary Terraform configuration files and a sample `config.yaml` file for customization.

## 🧾 Requirements

Before deploying OpenBao, ensure you have the following installed:

- [Terraform](https://www.terraform.io/downloads.html) (version >= 1.0)
- or [Opentofu](https://github.com/opentofu/opentofu)
- Access to the Outscale cloud platform
- Valid Outscale API credentials

## 📁 Directory Structure

```
templates/openbao/
├── config.yaml         # Cloud Init script for OpenBao configuration
├── main.tf             # Main infrastructure
├── outscale.tf         # Outscale provider configuration
└── variables.tf        # Definitions of input variables for Terraform
```

## 🚀 Deployment Steps

1. Clone the repository:
   ```bash
   git clone https://github.com/chimere-eu/ztiac.git
   cd ztiac/templates/openbao
   ```

2. Create a `terraform.tfvars` file with your Outscale credentials and other required variables.

3. Customize the `config.yaml` file as needed for your deployment.

4. Initialize Terraform:
   ```bash
   terraform init
   ```

5. Preview the deployment plan:
   ```bash
   terraform plan
   ```

6. Apply the deployment:
   ```bash
   terraform apply
   ```

7. Verify the deployment and access OpenBao:

   - Retrieve the IP address of the deployed instance and access it via ssh
   - Retrieve the root token placed under `/root/root_token.txt`
   - Access OpebBao in your browser using the IP address and the root token

>[!CAUTION]
> Don't forget to delete the `/root/root_token.txt` and `/root/init.json` files after you saved them to a secure location 

## ⚙️ Configuration Details

### `config.yaml`
The `config.yaml` file contains settings specific to OpenBao. Update this file to match your deployment requirements.

>[!WARNING]
> The OpenBao in this example is served though HTTP, which is not recommended for production environment

>[!TIP]
> You can use the rever-proxy feature presented [here](../reverse-proxy/README.md) to serve OpenBao through HTTPS with autogenerated certificates. But that would require to expose the port 80 of th reverse-proxy as well as setting a type A DNS record to its IP (for the HTTP challenge). 

On this deployment, OpenBao's data and config are stored in a dedicated disk that is attached to the VM. You can customize this to your needs by modifying the script in `config.yaml`. Don't forget to change the volumes accordingly in the `main.tf`.
Data and configuration are stored in `/mnt/openbao`
### `terraform.tfvars`
This file includes sensitive information like API keys and other variables. Ensure you do not share this file publicly.

## 🧹 Cleanup

To destroy the deployed resources, run:
```bash
terraform destroy
```

## 📌 Notes

>[!TIP]
> Every terraform command can be replaced by opentofu with the same arguments.  

>[!NOTE]
> In this example the OpenBao is assigned a public IP, in your use case you may want it to be fully private.

